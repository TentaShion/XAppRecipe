plugins {
    id 'com.android.application'

    // Kotlin
    id 'kotlin-android'
    id 'kotlin-kapt'

    // AndroidX Navigation
    id "androidx.navigation.safeargs.kotlin"

    // Google OSS
    id "com.google.android.gms.oss-licenses-plugin"
}

android {
    buildFeatures {
        dataBinding true
        viewBinding true
    }
    buildToolsVersion build_tools_version
    buildTypes {
        debug {
            applicationIdSuffix ".debug"
            versionNameSuffix "-debug"
        }
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            shrinkResources true
        }
    }
    compileOptions {
        coreLibraryDesugaringEnabled true
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    compileSdkVersion compile_sdk_version
    defaultConfig {
        applicationId "work.shion.xapprecipe"
        minSdkVersion min_sdk_version
        targetSdkVersion compile_sdk_version
        versionCode appver_code
        versionName appver_name
    }
    flavorDimensions "mode"
    kotlinOptions {
        jvmTarget = '1.8'
    }
    packagingOptions {
        exclude "DebugProbesKt.bin"
    }
    productFlavors {
        dev {
            dimension "mode"
            versionName "dev-${appver_name}"
        }

        prd {
            dimension "mode"
        }
    }
}

repositories {
    flatDir {
        dirs '../capacitor-cordova-android-plugins/src/main/libs', 'libs'
    }
}

dependencies {
    implementation project(':capacitor-android')
    implementation project(':capacitor-cordova-android-plugins')

    // Java 8+
    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:${ver_desugar_jdk}"

    // Local Project
    implementation project(":app_core")
    implementation project(":app_data")

    // 共通設定
    implementation BaseUi
    testImplementation UnitTestLocal

    // AndroidPreparation
    debugImplementation "work.shion.androidpreparation:debugger:${ver_prep_debugger}"
    implementation "work.shion.androidpreparation:views:${ver_prep_views}"

    // AndroidX
    implementation "androidx.biometric:biometric:${ver_droidx_biometric}"

    // Hyperion
    devImplementation "com.willowtreeapps.hyperion:hyperion-core:${ver_hyperion}"
    debugImplementation "com.willowtreeapps.hyperion:hyperion-plugin:${ver_hyperion}"
    devImplementation "com.willowtreeapps.hyperion:hyperion-plugin:${ver_hyperion}"

    // Google
    implementation "com.google.android.gms:play-services-oss-licenses:${ver_oss_licenses}"
    kapt "com.google.auto.service:auto-service:${ver_auto_service}"

    // Kotlin
    implementation platform("org.jetbrains.kotlin:kotlin-bom:${ver_kotlin}")
    implementation "org.jetbrains.kotlin:kotlin-stdlib"

    // Kotlin Coroutines
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:${ver_kotlin_coroutines}"
}

apply from: 'capacitor.build.gradle'

try {
    def servicesJSON = file('google-services.json')
    if (servicesJSON.text) {
        apply plugin: 'com.google.gms.google-services'
    }
} catch (Exception e) {
    logger.warn("google-services.json not found, google-services plugin not applied. Push Notifications won't work")
}
